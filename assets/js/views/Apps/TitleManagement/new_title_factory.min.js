
BMApp.register.factory("FixedReferences",["$http","$q","$state","$timeout","$localStorage","AuthFactory",function(m,i,a,b,o,g){var q=this;q.factory={getReferences:d,getIsoCodes:p,getDiscountCodes:f,lookupBisac:k,References:undefined,IsoCodes:undefined,DiscountCodes:undefined,};return q.factory;function e(){var t=Math.floor(Date.now()/1000);var s=5;var r=s*24*60*60;o.FixedReferencesFactory=o.FixedReferencesFactory||{};o.FixedReferencesFactory.Cache=o.FixedReferencesFactory.Cache||null;if(o.FixedReferencesFactory.Cache==null||t-o.FixedReferencesFactory.Cache>=r){o.FixedReferencesFactory={Cache:Math.floor(Date.now()/1000),IsoCodes:null,References:null,DiscountCodes:null,}}}function j(r){q.factory.references=r;o.FixedReferencesFactory.References=r}function n(r){q.factory.IsoCodes=r;o.FixedReferencesFactory.IsoCodes=r}function l(r){return m.post("api/IsoCodes/getAllCodes").then(function(s){n(s.data.data);if(r==true){return q.factory.IsoCodes}},function(){n(null);a.go("error",{code:"500",message:"An error occured loading the Country ISO Codes."})})}function p(){e();if(o.FixedReferencesFactory.IsoCodes==null){return l(true)}else{q.factory.IsoCodes=o.FixedReferencesFactory.IsoCodes;return i.when(q.factory.IsoCodes)}}function d(){e();if(o.FixedReferencesFactory.References==null){return h(true)}else{q.factory.references=o.FixedReferencesFactory.References;return i.when(q.factory.references)}}function h(r){return m.post("api/test",{withCredentials:false}).then(function(s){j({ContributorRoles:s.data.ContributorRoles,BisacGroups:s.data.BisacGroups,Editions:s.data.EditionTypes,PublicationStatuses:s.data.PublicationStatuses,FixedProductTypes:s.data.MediaTypes,FixedProductForms:s.data.ProductForms,FixedProductFormDetails:s.data.ProductFormDetails,FixedProductFormDetailSpecifics:s.data.ProductFormDetailSpecifics,AudienceTypes:s.data.AudienceTypes,});if(r==true){return q.factory.references}},function(s){j(null);a.go("error",{code:"500",message:"An error occured loading the fixed references."});return})}function k(s,t,r){m.post("api/bisacs/getGroupCodes",{groupId:s}).then(function(u){t(u.data)},function(u){a.go("error",{code:"500",message:"An error occured looking up the bisac code."});return})}function c(r){q.factory.DiscountCodes=r;o.FixedReferencesFactory.DiscountCodes=r}function f(){if(o.FixedReferencesFactory.DiscountCodes==null){return g.getInfo().then(function(r){c(r.clientinfo.DiscountCodes);return i.when(q.factory.DiscountCodes)})}else{q.factory.DiscountCodes=o.FixedReferencesFactory.DiscountCodes;return i.when(q.factory.DiscountCodes)}}}]);BMApp.register.factory("NewTitleDraftsFactory",["$q","$state","$localStorage","AuthFactory","GuidCreator","$timeout",function(a,e,b,f,d,c){}]);