function BasicInfo(a,b,c){var d=this;d.Model={ProductGroupId:a.ProductGroupId||null,Title:a.Title||"",Subtitle:a.Subtitle||"",Publisher:a.Publisher||"",Imprint:a.Imprint||"",ContentLanguage:a.ContentLanguage||"",Series:a.Series||"",NumberinSeries:a.NumberinSeries||"",MainDescription:a.MainDescription||"",ShortDescription:a.ShortDescription||""},d.FixedLanguageCodes=c.FixedISOLanguageCodes}function Covers(a,b){var c=this;c.Model={Covers:[]},c.log="",c.files={},c.upload=function(a,d){if(a){var e=d;c.files[e]={},c.files[e].status=null,b.Upload.upload({url:"//api.bookmasters.com/Files/Cover",data:{username:"poop",isbn13:d,CoverFile:a}}).then(function(a){c.files[e].name=a.config.data.CoverFile.name,c.files[e].type=a.config.data.CoverFile.type,c.files[e].size=a.config.data.CoverFile.size,c.files[e].status=!0,c.files[d].progress={percentage:"100%",width:100,color:"progress-bar-success"}},function(a){c.files[e].status=!1,c.files[d].progress={percentage:"Error",width:100,color:"progress-bar-danger"}},function(a){var b=parseInt(100*a.loaded/a.total);c.files[d].progress={percentage:b+"%",width:b,color:"progress-bar-info"}})}},c.formatBytes=function(a,b){if(0==a)return"0 Byte";var c=1e3,d=b+1||3,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return(a/Math.pow(c,f)).toPrecision(d)+" "+e[f]}}var Modals={ContributorBSModal:function(a,b,c){function d(){f.AdditionalTitles.push(new Components.AdditionalTitle(""))}function e(a){f.AdditionalTitles.splice(a,1)}var f=this;f.entryData=void 0,f.Method="",f.FirstName="",f.MiddleName="",f.LastName="",f.Prefix="",f.Suffix="",f.Hometown="",f.Role="",f.Biography="",f.FixedAuthorRoles=c.FixedAuthorRoles,f.IsRolePrimary=!1,f.IsTitlePrimary=!1,f.AdditionalTitles=[],f.addAdditionalTitle=d,f.removeAdditionalTitle=e},FormatBSModal:function(a,b,c){function d(){$.each(l.FixedIsoCodes,function(a,b){b.checked=!1})}function e(){$.each(l.FixedIsoCodes,function(a,b){b.checked=!0})}function f(){var a=l.FixedProductTypes.filter(function(a){return l.ProductType&&a.MediaType==l.ProductType.MediaType}),b=[];$.each(a,function(a,c){var d=b.map(function(a){return a.Form}).indexOf(c.Form);0>d&&null!==c.Form&&b.push({Form:c.Form})}),l.DynamicProductForms=b}function g(){var a=l.FixedProductTypes.filter(function(a){return l.ProductForm&&a.Form==l.ProductForm.Form}),b=[];$.each(a,function(a,c){var d=b.map(function(a){return a.Form}).indexOf(c.Detail);0>d&&null!==c.Detail&&b.push({Detail:c.Detail})}),l.DynamicProductFormDetails=b}function h(){l.Illustrations.push(new Components.Illustration(""))}function i(a){l.Illustrations.splice(a,1)}function j(){l.ComparableTitles.push(new Components.ComparableTitle(""))}function k(a){l.ComparableTitles.splice(a,1)}var l=this;l.entryData=void 0,l.isEbook=!1,l.Method="",l.ProductType=a.ProductType||"",l.ProductForm=a.ProductForm||"",l.ProductDetail=a.ProductDetail||"",l.ProductBinding=a.ProductBinding||"",l.ISBN13=a.ISBN13||"",l.Width=a.Width||"",l.Height=a.Height||"",l.Spine=a.Spine||"",l.Weight=a.Weight||"",l.PublicationDate=a.PublicationDate||"",l.Copyright=a.Copyright||"",l.StockDueDate=a.StockDueDate||"",l.TradeSales=a.TradeSales||"",l.Pages=a.Pages||"",l.CartonQuantity=a.CartonQuantity||"",l.USPrice=a.USPrice||"",l.DiscountCode=a.DiscountCode||"",l.CustomsValue=a.CustomsValue||"",l.Edition=a.Edition||"",l.EditionNumber=a.EditionNumber||"",l.EditionType=a.EditionType||"",l.CountryofOrigin=a.CountryofOrigin||"",l.PublicationLocation=a.PublicationLocation||"",l.TerritoryRights=a.TerritoryRights||"world",l.ComparableTitles=a.ComparableTitles||[],l.Illustrations=a.Illustrations||[],l.FixedProductTypesNew=[],l.FixedProductTypes=c.FixedProductTypes,l.FixedProductForms=[],l.FixedProductFormDetails=[],l.FixedProductFormDetailSpecifics=[],l.FixedIsoCodes=c.FixedISOCountryCodes,l.FixedDiscountCodes=c.FixedDiscountCodes,l.FixedEditionTypes=c.FixedEditionTypes,l.DynamicProductTypes=[],l.DynamicProductForms=[],l.DynamicProductFormDetails=[],l.DynamicProductFormDetailSpecifics=[],l.GetDynamicProductForms=f,l.GetDynamicProductDetails=g,l.addIllustration=h,l.removeIllustration=i,l.addComparableTitle=j,l.removeComparableTitle=k,l.uncheckAllSalesRights=d,l.checkAllSalesRights=e,l.openCalendar=function(a){a.preventDefault(),a.stopPropagation(),l.CalendarIsOpen=!0},l.CalendarIsOpen=!1,l.GetMediaTypes=function(){var a=[];$.each(l.FixedProductTypes,function(b,c){var d=a.map(function(a){return a.MediaType}).indexOf(c.MediaType);0>d&&null!==c.MediaType&&a.push({MediaType:c.MediaType})}),l.FixedProductTypesNew=a},b.$watch(function(){return l.ProductType},function(a,b){a&&"eBook"==a.MediaType?l.isEbook=!0:l.isEbook=!1})},ReviewModal:function(){var a=this;a.entryData=void 0,a.Method="",a.Method="",a.Name="",a.Publication="",a.Text=""},EndorsementModal:function(){var a=this;a.entryData=void 0,a.Method="",a.Name="",a.Affiliation="",a.Text=""},AppearanceAndEventModal:function(){var a=this;a.entryData=void 0,a.Method="",a.Name="",a.Date="",a.Location="",a.Text=""}},Contributors=function(a,b,c){function d(a,b){h.ContributorModal.Method=b||"edit",h.ContributorModal.entryData=a,$.each(a,function(b,c){h.ContributorModal[b]=a[b]||null}),h.showDialog=!0}function e(){$.each(h.ContributorModal.entryData,function(a,b){h.ContributorModal.entryData[a]=h.ContributorModal[a]}),"add"===h.ContributorModal.Method&&h.Model.Contributors.push(h.ContributorModal.entryData),h.showDialog=!1}function f(){h.showContributorModal(new Components.Contributor(""),"add")}function g(a){h.Model.Contributors.splice(a,1)}var h=this;h.Model={Contributors:a||[]},h.ContributorModal=new Modals.ContributorBSModal("",b,c),h.showDialog=!1,h.showContributorModal=d,h.onContributorModalAction=e,h.addContributor=f,h.removeContributor=g},Demographics=function(a,b,c){var d=this;d.ValidSubject=!1,d.ValidWatch=["NTFNGForm.DemographicsFormPanel.$valid","NTFNGForm.DemographicsFormPanel.AddBisacs.$valid","NTFNGForm.DemographicsFormPanel.AddBisacs.AddBisacsRepeat.$valid",function(){return d.Model.Bisacs.length>0}],b.$scope.$watchGroup(d.ValidWatch,function(a){-1==a.indexOf(!1)?d.ValidSubject=!0:d.ValidSubject=!1}),d.Model={Audience:a.Audience||"",Bisacs:a.Bisacs||[],AgeRange:a.AgeFrom||""},d.FixedBisacListContainer=[],d.AgeRangeRequired=!1,d.AgeRangeDisabled=!0,d.AudienceRequired=!1,d.AudienceDisabled=!1,d.FixedList=c.FixedBisacGroups,d.FixedAudienceTypes=c.FixedAudienceTypes,d.FixedAgeRanges=c.FixedAgeRanges,b.$scope.$watchCollection(function(){return d.Model.Audience},function(a,b){switch(a.Name){case"Children/juvenile":d.AgeRangeRequired=!0,d.AgeRangeDisabled=!1;break;case"Young adult":d.AgeRangeRequired=!0,d.AgeRangeDisabled=!1;break;default:d.AgeRangeRequired=!1,d.AgeRangeDisabled=!0}d.DynamicAgeRanges=d.FixedAgeRanges.filter(function(a){return console.log(d.Model.Audience,a),d.Model.Audience&&a.AudienceTypeId==d.Model.Audience.Id})}),b.$scope.$watchCollection(function(){return d.Model.Bisacs},function(a,c){0==d.Model.Bisacs.length&&d.CheckJuv(),$.each(d.Model.Bisacs,function(a,c){b.$scope.$watchCollection(function(){return c},function(a,b){d.CheckJuv()})})}),d.UpdateBisacCodes=function(a){b.$timeout(function(){b.FixedReferences.lookupBisac(d.Model.Bisacs[a].BisacGroup.Id,function(b){d.FixedBisacListContainer[a]=b.data},function(a){alert()})})},$.each(d.Model.Bisacs,function(a,b){d.UpdateBisacCodes(a)}),d.addBisac=function(){d.Model.Bisacs.push(new Components.Bisac(d.FixedList||""))},d.removeBisac=function(a){d.Model.Bisacs.splice(a,1)},d.CheckJuv=function(){var a=!1;$.each(d.Model.Bisacs,function(b,c){("JUV"==c.BisacGroup.Prefix||"JNF"==c.BisacGroup.Prefix)&&(a=!0)}),a?($.each(d.FixedAudienceTypes,function(a,b){"Children/juvenile"==b.Name&&(d.Model.Audience=b)}),d.AudienceDisabled=!0,d.AudienceRequired=!1,d.AgeRangeRequired=!0,d.AgeRangeDisabled=!1):(d.AudienceDisabled=!1,d.AudienceRequired=!0,d.AgeRangeRequired=!1,d.AgeRangeDisabled=!0)}},Drafts=function(a,b){var c=this;c.Drafts=[],c.EmptyCache=function(){confirm("Are you sure you want to delete all your saved drafts?")&&b.NewTitleDraftsFactory.EmptyCache().then(function(a){c.Drafts=[],c.Drafts=a.Drafts})},c.LoadDraft=function(b){a.LoadDraft(b)},c.RemoveDraft=function(a){b.NewTitleDraftsFactory.RemoveDraft(a)},c.GetDrafts=function(){b.NewTitleDraftsFactory.GetDrafts().then(function(a){c.Drafts=[],c.Drafts=a.Drafts})},c.FormatDate=function(a,b){return moment(a,"X").format("dddd, MMMM Do YYYY, h:mm:ss a")},c.GetDrafts(),c.SaveDraft=function(){b.NewTitleDraftsFactory.SaveDraft(JSON.stringify({DraftId:a.Form.DraftId,ProductGroupId:a.Form.ProductGroupId,CreationDate:a.Form.CreationDate,Content:{BasicInfo:a.BasicInfo.Model,Contributors:a.Contributors.Model,Formats:a.Formats.Model,Demographics:a.Demographics.Model,Marketing:a.Marketing.Model}})).then(function(a){c.Drafts=a.Drafts})}};BMApp.register.factory("FixedReferences",["$http","$q","$state","$timeout","$localStorage","AuthFactory",function(a,b,c,d,e,f){function g(b,d){null==e.FixedReferencesFactory.References||e.FixedReferencesFactory.References?a.post("API/FixedReferences/GetAllReferences").then(function(a){e.FixedReferencesFactory.References=a.data.data,b(e.FixedReferencesFactory.References)},function(a){c.go("error",{code:"500",message:"An error occured loading the fixed references."})}):b(e.FixedReferencesFactory.References)}function h(b,d,e){a.post("API/BisacCodes/GetGroupCodes",{groupId:b}).then(function(a){d(a.data)},function(a){c.go("error",{code:"500",message:"An error occured looking up the bisac code."})})}function g(b,d){null==e.FixedReferencesFactory.References||e.FixedReferencesFactory.References?a.post("API/FixedReferences/GetAllReferences").then(function(a){e.FixedReferencesFactory.References=a.data.data,b(e.FixedReferencesFactory.References)},function(a){c.go("error",{code:"500",message:"An error occured loading the fixed references."})}):b(e.FixedReferencesFactory.References)}function i(a,b){null==e.FixedReferencesFactory.DiscountCodes||e.FixedReferencesFactory.DiscountCodes?f.getInfo().then(function(b){e.FixedReferencesFactory.DiscountCodes=b.clientinfo.DiscountCodes,a(e.FixedReferencesFactory.DiscountCodes)}):a(e.FixedReferencesFactory.DiscountCodes)}var j=this;return j.factory={GetDiscountCodes:i,lookupBisac:h,GetFixedReferences:g,References:void 0,DiscountCodes:void 0},j.factory}]),BMApp.register.factory("NewTitleDraftsFactory",["$q","$state","$localStorage","AuthFactory","GuidCreator","$timeout","toasty",function(a,b,c,d,e,f,g){function h(a){var b=this;b.UserId=a.UserId||n.UserId,b.Drafts=a.Drafts||[]}function i(a){var b=this;b.DraftId=a.DraftId||"",b.ProductGroupId=a.ProductGroupId||"",b.Title=a.Content.BasicInfo.Title||"",b.CreationDate=a.CreationDate||moment().format("X"),b.LastUpdated=a.LastUpdated||moment().format("X"),b.Content=JSON.stringify(a.Content)||""}function j(){return a(function(a,e){return n.Init?void a():void f(function(){d.getInfo().then(function(a){n.UserId=a.credentials.userid})}).then(function(){c.NewTitleDraftsFactory=c.NewTitleDraftsFactory||{},c.NewTitleDraftsFactory.Users=c.NewTitleDraftsFactory.Users||[];var d=c.NewTitleDraftsFactory.Users.filter(function(a){return a.UserId==n.UserId});d.length?n.factory.User=d[0]:n.factory.User=c.NewTitleDraftsFactory.Users[c.NewTitleDraftsFactory.Users.push(new h(""))-1],null!=n.UserId?(n.Init=!0,a()):e(b.go("error",{code:"500",message:"An unknown error occured in NewTitleDraftsFactory. (Reject cacheInit() UserID was not returned)"}))})})}function k(){return n.Init=!1,n.factory.User={},c.NewTitleDraftsFactory={},a.when(n.factory.User)}function l(){return j().then(function(){return a.when(n.factory.User)})}function m(a){return j().then(function(){var b=new i(JSON.parse(a)),c=n.factory.User.Drafts.map(function(a){return a.DraftId}).indexOf(b.DraftId);return 0>c?(n.factory.User.Drafts.unshift(b),g.success({title:"Saved Draft!",msg:"Your draft has been saved to your computer.",theme:"bootstrap",timeout:5e3})):(b.LastUpdated=moment().format("X"),n.factory.User.Drafts[c]=b,g.info({title:"Saved Draft!",msg:"Your draft has been updated.",theme:"bootstrap",timeout:5e3})),n.factory.User.Drafts.length>=4&&(n.factory.User.Drafts.length=4),l()})}var n=this;return n.UserId=null,n.Drafts=[],n.Init=!1,n.DraftLocation="",n.factory={User:{},Cache:{},EmptyCache:k,SaveDraft:m,GetDrafts:l},n.factory}]),BMApp.register.controller("NewTitleForm",["scriptLoader","$scope","$rootScope","$timeout","FixedReferences","$stateParams","GuidCreator","Upload","NewTitleDraftsFactory","toasty","$localStorage","$q","toasty",function(a,b,c,d,e,f,g,h,i,j,k,l,j){function m(){n.isValid=!1,n.ValidSubject=!1,n.ValidFormWatch=["NTFNGForm.BasicInfoFormPanel.$valid",function(){return n.Formats.Model.Formats.length>0},function(){return n.Contributors.Model.Contributors.length>0},function(){return n.Demographics.ValidSubject},"NTFNGForm.BasicInfoExtendedFormPanel.$valid","NTFNGForm.DemographicsFormPanel.$valid","NTFNGForm.MarketingFormPanel.$valid","NTFNGForm.CoversFormPanel.$valid"],b.$watchGroup(n.ValidFormWatch,function(a){-1==a.indexOf(!1)&&(n.isValid=!0),1==a[3]?n.ValidSubject=!0:n.ValidSubject=!1,console.log(n.isValid,a)}),n.BasicInfo=new BasicInfo(n.data.BasicInfo||"",n.Dependencies,n.References),n.Contributors=new Contributors(n.data.Contributors.Contributors||"",n.Dependencies,n.References),n.Formats=new Formats(n.data.Formats.Formats||"",n.Dependencies,n.References),n.Demographics=new Demographics(n.data.Demographics||"",n.Dependencies,n.References),n.Marketing=new Marketing(n.data.Marketing||"",n.Dependencies,n.References),n.Covers=new Covers(n.data.Covers||"",n.Dependencies,n.References),n.Drafts=new Drafts(n,n.Dependencies),n.LoadDraft=function(a){n.Form.DraftId=a.DraftId,n.Form.ProductGroupId=a.ProductGroupId,n.Form.CreationDate=a.CreationDate,n.data=JSON.parse(a.Content),m()},n.RefreshJson=function(){$("#jsonPre").text(JSON.stringify({Form:n.Form,BasicInfo:n.BasicInfo.Model,Contributors:n.Contributors.Model,Formats:n.Formats.Model,Demographics:n.Demographics.Model,Marketing:n.Marketing.Model,Covers:n.Covers.Model}))},d(function(){$('[data-toggle="popover"]').popover()})}var n=this;n.Dependencies={scriptLoader:a,$scope:b,$rootScope:c,$timeout:d,FixedReferences:e,$stateParams:f,toasty:j,NewTitleDraftsFactory:i,Upload:h},n.References={FixedAuthorRoles:[],FixedProductTypes:[],FixedEditionTypes:[],FixedAudienceTypes:[],FixedAgeRanges:[],FixedBisacGroups:[],FixedISOCountryCodes:[],FixedISOLanguageCodes:[],FixedDiscountCodes:[]},n.EmptyCache=function(){k.FixedReferencesFactory={}},n.data={BasicInfo:{Publisher:"h.f.ullmann"},Contributors:{},Demographics:{},Formats:{},Marketing:{}},n.Form={DraftId:g.CreateGuid(),ProductGroupId:null,CreationDate:moment().format("X")},e.GetDiscountCodes(function(a){n.References.FixedDiscountCodes=a}),e.GetFixedReferences(function(a){n.References.FixedAuthorRoles=a.FixedAuthorRoles,n.References.FixedProductTypes=a.FixedProductTypes,n.References.FixedEditionTypes=a.FixedEditionTypes,n.References.FixedAudienceTypes=a.FixedAudienceTypes,n.References.FixedAgeRanges=a.FixedAgeRanges,n.References.FixedBisacGroups=a.FixedBisacGroups,n.References.FixedISOCountryCodes=a.FixedISOCountryCodes,n.References.FixedISOLanguageCodes=a.FixedISOLanguageCodes,m()})}]);var Formats=function(a,b,c){var d=this;d.Model={Formats:a||[]},d.FormatModal=new Modals.FormatBSModal("",b.$scope,c),d.showDialog=!1,d.showFormatModal=function(a,c){b.$scope.$broadcast("show-errors-reset"),d.FormatModal.Method=c||"edit",d.FormatModal.entryData=a,$.each(a,function(b,c){d.FormatModal[b]=a[b]||null}),b.$timeout(function(){d.FormatModal.GetMediaTypes()}).then(function(){d.FormatModal.ProductType=a.ProductType}),b.$timeout(function(){d.FormatModal.GetDynamicProductForms()}).then(function(){d.FormatModal.ProductForm=a.ProductForm}),b.$timeout(function(){d.FormatModal.GetDynamicProductDetails()}).then(function(){d.FormatModal.ProductDetail=a.ProductDetail}),d.showDialog=!0},d.onFormatModalAction=function(){$.each(d.FormatModal.entryData,function(a,b){d.FormatModal.entryData[a]=d.FormatModal[a]}),"add"===d.FormatModal.Method&&d.Model.Formats.push(d.FormatModal.entryData),d.showDialog=!1},d.addFormat=function(){d.showFormatModal(new Components.Format(""),"add")},d.removeFormat=function(a){d.Model.Formats.splice(a,1)}},Marketing=function(a){function b(a){g.Model[a+"s"].push(new Components[a])}function c(a){g.showMarketingItemModal(new Components[a],a,"add")}function d(a,b,c){g[b+"Modal"].Method=c||"edit",g[b+"Modal"].entryData=a,$.each(a,function(c,d){g[b+"Modal"][c]=a[c]||null}),g["show"+b+"Dialog"]=!0}function e(a){$.each(g[a+"Modal"].entryData,function(b,c){g[a+"Modal"].entryData[b]=g[a+"Modal"][b]}),"add"===g[a+"Modal"].Method&&g.Model[a+"s"].push(g[a+"Modal"].entryData),g["show"+a+"Dialog"]=!1}function f(a,b){g.Model[a+"s"].splice(b,1)}var g=this;g.Model={Websites:a.Websites||[],MarketingAndPublicitys:a.MarketingAndPublicitys||[],Reviews:a.Reviews||[],Endorsements:a.Endorsements||[],AppearanceAndEvents:a.AppearanceAndEvents||[]},g.addSingleMarketingItem=b,g.addMarketingItem=c,g.showMarketingItemModal=d,g.onMarketingItemModalAction=e,g.removeMarketingItem=f,g.ReviewModal=new Modals.ReviewModal(""),g.showReviewDialog=!1,g.EndorsementModal=new Modals.EndorsementModal(""),g.showEndorsementDialog=!1,g.AppearanceAndEventModal=new Modals.AppearanceAndEventModal(""),g.showAppearanceAndEventDialog=!1},Components={AdditionalTitle:function(a){var b=this;b.ISBN=a.ISBN||"",b.Title=a.Title||""},Contributor:function(a){var b=this;b.FirstName=a.FirstName||"",b.MiddleName=a.MiddleName||"",b.LastName=a.LastName||"",b.Prefix=a.Prefix||"",b.Suffix=a.Suffix||"",b.Hometown=a.Hometown||"",b.Role=a.Role||"",b.Biography=a.Biography||"",b.IsRolePrimary=a.IsRolePrimary||!1,b.IsTitlePrimary=a.IsTitlePrimary||!1,b.AdditionalTitles=a.AdditionalTitles||[]},Bisac:function(a){var b=this;b.FixedList=[],b.FixedList2=[],b.BisacGroup="",b.Code="",b.Text="",b.Group="",b.LongName="",b.BisacID=""},Review:function(){var a=this;a.Name="",a.Publication="",a.Text=""},MarketingAndPublicity:function(){var a=this;a.Type="",a.Description=""},AppearanceAndEvent:function(){var a=this;a.EventName="",a.Date="",a.Location="",a.Description=""},Website:function(){var a=this;a.URL="",a.Type=""},Endorsement:function(){var a=this;a.Name="",a.Affiliation="",a.Text=""},Format:function(a){var b=this;b.ProductType=a.ProductType||"",b.ProductForm=a.ProductForm||"",b.ProductDetail=a.ProductDetail||"",b.ProductBinding=a.ProductBinding||"",b.ISBN13=a.ISBN13||"",b.Width=a.Width||"",b.Height=a.Height||"",b.Spine=a.Spine||"",b.Weight=a.Weight||"",b.PublicationDate=a.PublicationDate||"",b.Copyright=a.Copyright||"",b.StockDueDate=a.StockDueDate||"",b.TradeSales=a.TradeSales||"",b.Pages=a.Pages||"",b.CartonQuantity=a.CartonQuantity||"",b.USPrice=a.USPrice||"",b.DiscountCode=a.DiscountCode||"",b.CustomsValue=a.CustomsValue||"",b.Edition=a.Edition||"",b.EditionNumber=a.EditionNumber||"",b.EditionType=a.EditionType||"",b.CountryofOrigin=a.CountryofOrigin||"",b.PublicationLocation=a.PublicationLocation||"",b.ComparableTitles=a.ComparableTitles||[]},ComparableTitle:function(a){var b=this;b.ISBN=a.ISBN||"",b.Title=a.Title||""},Illustration:function(a){var b=this;b.Type=a.Type||"",b.Description=a.Description||"",b.Number=a.Number||""}};