"use strict";var BMApp=angular.module("BMApp",["ngAnimate","ngStorage","ngResource","ui.router","ui.router.util","ui.event","ngFileUpload","nya.bootstrap.select","ui.bootstrap","angular-toasty","app.controllers","app.services","app.directives","app.wrappers","app.validators"]);BMApp.config(["$stateProvider","$urlRouterProvider","$controllerProvider","$compileProvider","$filterProvider","$provide","$httpProvider","toastyConfigProvider",function(a,b,c,d,e,f,g,h){h.setConfig({limit:10,showClose:!0,clickToClose:!1,position:"bottom-right",timeout:5e3,sound:!1,html:!1,shake:!1,theme:"bootstrap"}),BMApp.register={controller:c.register,directive:d.directive,filter:e.register,factory:f.factory,service:f.service},g.defaults.headers.post.Accept="application/json, text/javascript",g.defaults.headers.post["Content-Type"]="application/json; charset=utf-8",g.defaults.headers.common.Accept="application/json, text/javascript",g.defaults.headers.common["Content-Type"]="application/json; charset=utf-8";var i=["$q","AuthFactory",function(a,b){var c=a.defer();return b.getInfo().then(function(a){null!=a?c.resolve():c.reject("Not logged in")}),c.promise}],j=["$http","$stateParams","$state","scriptLoader","AuthFactory",function(a,b,c,d,e){var f="";return f="home"==b.page?b.app+"/index":b.app+"/"+b.page,a.get(f).then(function(a){return d.loadScriptTagsFromData(a.data)}).then(function(a){return a})}];b.otherwise("/bm/main/index/"),a.state("bm",{url:"/bm","abstract":!0,templateUrl:"Shared/appBootstrap"}),a.state("bm.app",{"abstract":!0,url:"/:app",params:{app:"main"},views:{}}),a.state("bm.app.page",{url:"/:page/:child",params:{app:"",page:"",child:null,id:{value:null}},resolve:{authenticated:i,deps:["scriptLoader",function(a){return a}]},views:{"mainContent@bm":{templateProvider:j}}}),a.state("login",{url:"/login",templateUrl:"Shared/login"}).state("error",{url:"/error",params:{code:"",message:""},templateUrl:"Shared/error"}).state("404",{url:"/404",templateUrl:"Shared/notFound"})}]),BMApp.run(["$rootScope","$state","$log","AuthFactory",function(a,b,c,d){a.previousState,a.previousStateParams,a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.previousState=e.name,a.previousStateParams=f}),a.$on("$stateChangeError",function(a,c,e,f,g,h){switch(h.status){case 200:default:break;case 400:b.go("error",{code:"400",message:"Bad request. The request could not be understood by the server due to malformed syntax. The client SHOULD NOT repeat the request without modifications."});break;case 401:d.logout();break;case 403:b.go("error",{code:"403",message:"You do not have privileges to access this application."});break;case 404:b.go("error",{code:"404",message:"Part of / and or / the page requested was not found."});break;case 500:b.go("error",{code:"500",message:"An internal server error has occured."})}})}]);var appControllers=angular.module("app.controllers",[]),app={name:"BM",title:"Bookmasters - Dashboard",version:"0.0.1",debug:!0,settings:{colors:{white:"#fff",black:"#000","gray-light":"#999","gray-lighter":"#eee",gray:"#666","gray-dark":"#343434","gray-darker":"#222","gray-semi-light":"#777","gray-semi-lighter":"#ddd","brand-primary":"#5d8fc2","brand-success":"#64bd63","brand-warning":"#f0b518","brand-danger":"#dd5826","brand-info":"#5dc4bf"},screens:{"xs-max":767,"sm-min":768,"sm-max":991,"md-min":992,"md-max":1199,"lg-min":1200},navCollapseTimeout:2500},state:{"nav-static":!1,"sidebar-left":!0,"sidebar-right":!1}},Helpers=function(){this._initResizeEvent(),this._initOnScreenSizeCallbacks()};Helpers.prototype={_resizeCallbacks:[],_screenSizeCallbacks:{xs:{enter:[],exit:[]},sm:{enter:[],exit:[]},md:{enter:[],exit:[]},lg:{enter:[],exit:[]}},isScreen:function(a){var b=window.innerWidth;return(b>=app.settings.screens[a+"-min"]||"xs"==a)&&(b<=app.settings.screens[a+"-max"]||"lg"==a)},getScreenSize:function(){var a=window.innerWidth;return a<=app.settings.screens["xs-max"]?"xs":a>=app.settings.screens["sm-min"]&&a<=app.settings.screens["sm-max"]?"sm":a>=app.settings.screens["md-min"]&&a<=app.settings.screens["md-max"]?"md":a>=app.settings.screens["lg-min"]?"lg":void 0},onScreenSize:function(a,b,c){c="undefined"!=typeof c?c:!0,this._screenSizeCallbacks[a][c?"enter":"exit"].push(b)},_initResizeEvent:function(){var a;$(window).on("resize",function(){clearTimeout(a),a=setTimeout(function(){$(window).trigger("sn:resize")},100)})},_initOnScreenSizeCallbacks:function(){var a,b=this,c=this.getScreenSize();$(window).resize(function(){clearTimeout(a),a=setTimeout(function(){var a=b.getScreenSize();a!=c&&(b._screenSizeCallbacks[c].exit.forEach(function(b){b(a,c)}),b._screenSizeCallbacks[a].enter.forEach(function(b){b(a,c)}),console.log("screen changed. new: "+a+", old: "+c)),c=a},100)})}},app.helpers=new Helpers,appControllers.controller("BMAppController",["$scope","$localStorage","AuthFactory","$q","$http",function(a,b,c,d,e){var f=this;f.Feedback=new Feedback({$http:e,AuthFactory:c}),a.app=app,a.logout=c.logout,c.isLoggedIn(!0).then(function(b){console.log(c),a.user=b})}]);var Feedback=function(a){var b=this;b.FeedbackModalVisible=!1,b.feedback={username:"",email:"",url:"",useragent:"",platform:"",contact:"",message:""},b.submitBtn="Submit",b.success=!1,b.showFeedbackModal=function(){b.feedback.message="",b.submitBtn="Submit",b.success=!1,b.feedback.url=window.location.href,b.feedback.useragent=navigator.userAgent,b.feedback.platform=navigator.platform,a.AuthFactory.getInfo().then(function(a){b.feedback.username=a.credentials.username,b.feedback.email=a.credentials.email}),b.FeedbackModalVisible=!b.FeedbackModalVisible},b.submitFeedback=function(){b.submitBtn="Submitting...",a.$http.post("feedback/apisubmit",b.feedback).then(function(a){b.submitBtn="Success!",b.success=!0},function(a){b.submitBtn="Failed"})}},appServices=angular.module("app.services",[]);appServices.factory("GuidCreator",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()}return{CreateGuid:a}}),appServices.factory("$exceptionHandler",["$log",function(a){return function(b,c){var d=JSON.parse(localStorage.getItem("bm-angular-errors"))||{};d[(new Date).getTime()]=arguments,localStorage.setItem("bm-angular-errors",JSON.stringify(d)),app.debug&&a.error.apply(a,arguments)}}]),appServices.factory("scriptLoader",["$q","$timeout",function(a,b){var c=[];return{loadScriptTagsFromData:function(b){var c=a.defer(),d=$($.parseHTML(b,document,!0)),e=d.filter('script[data-src][type="text/javascript-lazy"]').add(d.find('script[data-src][type="text/javascript-lazy"]')),f=this;return f.loadScripts(e.map(function(){return $(this).attr("data-src")}).get()).then(function(){c.resolve(b)}),c.promise},loadScripts:function(d,e){e=e||"partial";var f=a.defer();return f.resolve(),d.forEach(function(d){if(c[d])return void(c[d].processing&&(f=c[d]));if("partial"==e)var g=document.createElement("script"),h=$(g).attr("data-bm-lazy",e).addClass("partial-script"),i=a.defer();else var g=document.createElement("script"),h=$(g).attr("data-bm-lazy",e),i=a.defer();g.src=d,i.processing=!0,h.load(function(){b(function(){i.resolve(),i.processing=!1})}),f.promise.then(function(){document.body.appendChild(g)}),c[d]=f=i}),f.promise}}}]),appServices.factory("AuthFactory",["$http","$state","$q","$localStorage","$timeout",function(a,b,c,d,e){function f(a){n.user=a,d.user=a}function g(){a.post(m+"logout").then(function(a){d.$reset(),d.user=null,f(null),b.go("login")},function(a){b.go("error")})}function h(b,c,d){a.post(m+"login",b).then(function(a){console.log(a),f(a.data.data),c(a.data)},function(a){f(null),d(a.data)})}function i(b,c,d){a.post(m+"register",b).success(function(a){c(a)}).error(function(a){d(a)})}function j(b,c,d){a.post(m+"forgot",b).success(function(a){c(a)}).error(function(a){d(a)})}function k(c){return a.post(m+"getuser").then(function(a){return console.log(a),f(a.data.data),1==c?a.data.data:void 0},function(a){return f(null),b.go("login")})}function l(){return null==d.user||null==n.user?(console.log("server"),n.isLoggedIn(!0)):(n.user=d.user,c.when(n.user))}var m="auth/",n={user:null,isLoggedIn:k,getInfo:l,logout:g,forgot:j,login:h,register:i};return n}]);var appDirectives=angular.module("app.directives",[]);appDirectives.directive("body",function(){return{restrict:"E",link:function(a,b){b.on("click","a[href=#]",function(a){a.preventDefault()})}}}),appDirectives.directive("bmAction",["$rootScope",function(a){var b={"toggle-left-sidebar":function(a,b){b.app.state["sidebar-left"]=!b.app.state["sidebar-left"]}};return{restrict:"A",link:function(a,c,d){angular.isDefined(d.bmAction)&&""!=d.bmAction&&c.on("click",function(e){a.$apply(function(){b[d.bmAction].call(c[0],e,a)}),e.preventDefault()}),angular.isDefined(d.tooltip)&&""!=d.bmAction&&c.tooltip()}}}]),appDirectives.directive("bmSidebarScroll",["scriptLoader",function(a){return function(b,c,d){function e(){$(c).niceScroll({cursorcolor:"#6181a2",cursorborder:"0px solid #fff",cursorborderradius:"0px",cursorwidth:"5px"}),$(c).getNiceScroll().resize(),$(".sidebar-left").hasClass("hide-left-bar")&&$(c).getNiceScroll().hide(),$(c).getNiceScroll().show()}a.loadScripts(["http://www.bookmasters.com/CDN/bower_components/jquery.nicescroll/dist/jquery.nicescroll.min.js"],"sidebar").then(e)}}]),appDirectives.directive("bmNavigation",["$timeout","$rootScope","$state",function(a,b,c){var d=function(a,c){this.$el=a,this.scope=c,this.helpers=c.app.helpers,b.changeNavigationItem=$.proxy(this.changeNavigationItem,this)};return d.prototype={collapseLeftSidebar:function(){$(this.$el).addClass("hide-left-bar"),$("#main-content").addClass("merge-left"),this.scope.app.state["sidebar-left"]=!1},expandLeftSidebar:function(){$(this.$el).addClass("hide-left-bar"),$("#main-content").addClass("merge-left"),this.scope.app.state["sidebar-left"]=!0},toggleLeftSidebar:function(){$(this.$el).toggleClass("hide-left-bar"),$(this.$el).hasClass("hide-left-bar"),$("#main-content").toggleClass("merge-left"),$("#container").hasClass("open-right-panel")&&$("#container").removeClass("open-right-panel"),$(".sidebar-right").hasClass("open-right-bar")&&$(".sidebar-right").removeClass("open-right-bar"),$(".header").hasClass("merge-header")&&$(".header").removeClass("merge-header")},checkLeftSidebarState:function(){return this.scope.app.state["sidebar-left"]},checkRightSidebarState:function(){return this.scope.app.state["sidebar-right"]},changeNavigationItem:function(a,b,d){var e=this.$el.find('a[href="'+c.href(b,d)+'"]');e.is(".active > .collapse > li > a")||this.$el.find(".active .active").closest(".collapse").collapse("hide"),this.$el.find("#innersidebar .active").removeClass("active"),e.closest("li").addClass("active").parents("li").addClass("active").addClass("open"),e.closest(".collapse").addClass("in").siblings("a[data-toggle=collapse]").removeClass("collapsed")}},{link:function(e,f){var g=new d(f,e);a(function(){g.changeNavigationItem({},c.$current,c.params),b.$on("$stateChangeStart",$.proxy(g.changeNavigationItem,g)),f.find(".collapse").on("show.bs.collapse",function(a){if(a.target==a.currentTarget){var b=$(this).prev("[data-toggle=collapse]");$(b.data("parent")).find(".collapse.in").not($(this)).collapse("hide")}}).on("show.bs.collapse",function(a){a.target==a.currentTarget&&$(this).closest("li").addClass("open")}).on("hide.bs.collapse",function(a){a.target==a.currentTarget&&$(this).closest("li").removeClass("open")})}),e.$watch('app.state["sidebar-left"]',function(a,b){a!=b&&g.toggleLeftSidebar()}),$(".header,#main-content,.sidebar-left").click(function(){$("#container").hasClass("open-right-panel")&&$("#container").removeClass("open-right-panel"),$(".sidebar-right").hasClass("open-right-bar")&&$(".sidebar-right").removeClass("open-right-bar"),$(".header").hasClass("merge-header")&&$(".header").removeClass("merge-header")})}}}]),appDirectives.directive("bsRadio",["$compile","$timeout",function(a,b){return{restrict:"E",scope:{model:"=",value:"@",label:"@",name:"@"},template:'<div class="radio radio-primary"><input type="radio" name="name" ng-model="model" value="value" ng-checked="model==value" ng-click="model=value"><label name="name" ng-click="model=value">{{label}}{{model==value}}</label></div>',compile:function(a){a.addClass("bs-radio")}}}]),appDirectives.directive("modalShow",function(){return{restrict:"A",scope:{modalVisible:"="},link:function(a,b,c){a.showModal=function(a){a?b.modal("show"):b.modal("hide")},c.modalVisible?(a.$watch("modalVisible",function(b,c){a.showModal(b)}),b.bind("hide.bs.modal",function(){a.modalVisible=!1,a.$$phase||a.$root.$$phase||a.$apply()})):a.showModal(!0)}}});var appWrappers=angular.module("app.wrappers",[]);appWrappers.directive("datetimepicker",["$timeout","$parse",function(a,b){return{link:function(c,d,e){return a(function(){var a=b(e.ngModel),f=c.$eval(e.datetimepickerOptions)||{};return f.allowInputToggle=!0,f.useCurrent=!1,f.icons={time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-screenshot",clear:"fa fa-trash",close:"fa fa-times"},$(d).datetimepicker(f).on("dp.change",function(b){c.$apply(function(){return a.assign(c,b.target.value)})})})}}}]);var appValidators=angular.module("app.validators",[]);appValidators.directive("showErrors",["$timeout","showErrorsConfig","$interpolate",function(a,b,c){var d,e,f,g={isbnValidate:"The ISBN you supplied is invalid",bmPassword:"Your password must contain a lowercase and uppercase letter, numbers, and 8 or more characters long",bmWebsite:"Please enter a valid URL. Example: http://bookmasters.com",required:"This field is required",minlength:"Your input is too short",maxlength:"Your input is too long",email:"Your email address is invalid",number:"Your input is not a number",price:"The given amount is invalid. Ex 125,944.10"};return e=function(a){var c;return c=b.trigger,a&&null!=a.trigger&&(c=a.trigger),c},d=function(a){var c;return c=b.showSuccess,a&&null!=a.showSuccess&&(c=a.showSuccess),c},f=function(b,f,h,i){var j,k,l,m,n,o,p,q;if(j=!1,n=b.$eval(h.showErrors),o=d(n),q=e(n),k=f[0].querySelector(".form-control[name]"),m=angular.element(k),l=c(m.attr("name")||"")(b),!l)throw"show-errors element has no child input elements with a 'name' attribute and a 'form-control' class";return m.bind(q,function(){return j=!0,p(i[l].$invalid)}),b.$watch(function(){return i[l]&&i[l].$invalid},function(a){return j?p(a):void 0}),b.$on("show-errors-check-validity",function(){return p(i[l].$invalid)}),b.$on("show-errors-reset",function(){return a(function(){return f.removeClass("has-error"),f.removeClass("has-success"),f.find(".help-block").remove(),j=!1},0,!1)}),p=function(a){return f.toggleClass("has-error",a),f.find(".help-block").remove(),$.each(i[l].$error,function(a){console.log(a),f.append('<span class="help-block">'+g[a]+"</span>")}),o?f.toggleClass("has-success",!a):void 0}},{restrict:"A",require:"^form",compile:function(a,b){if(-1===b.showErrors.indexOf("skipFormGroupCheck")&&!a.hasClass("form-group")&&!a.hasClass("input-group"))throw"show-errors element does not have the 'form-group' or 'input-group' class";return f}}}]).provider("showErrorsConfig",function(){var a,b;a=!1,b="blur",this.showSuccess=function(b){return a=b},this.trigger=function(a){return b=a},this.$get=function(){return{showSuccess:a,trigger:b}}}),appValidators.directive("bmValidateOptions",["$http","$parse","$timeout",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(d,e,f,g){var h=b(f.bmValidateOptions);$.each(h(),function(b,d){switch(d){case"isbn":g.$parsers.push(function(b){var d=e.parent().parent(),f=e.siblings(".input-group-addon").children("i");return c(function(){f.removeClass().addClass("fa fa-fw fa-refresh fa-spin")}).then(function(){a.post("http://api.bookmasters.com/validation/isbn13",{isbn13:b}).then(function(){g.$setValidity("isbnValidate",!0),f.removeClass("fa-refresh fa-spin fa-close fa-question").addClass("fa-check"),d.removeClass("has-error").addClass("has-success")},function(){d.removeClass("has-success"),f.removeClass("fa-refresh fa-spin fa-check fa-question").addClass("fa-close"),g.$setValidity("isbnValidate",!1)})}),b});break;case"bmpassword":g.$parsers.push(function(a){var b=/(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}/;return b.test(a)?g.$setValidity("bmPassword",!0):g.$setValidity("bmPassword",!1),a});break;case"bmwebsite":g.$parsers.push(function(a){var b=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i;return b.test(a)?g.$setValidity("bmWebsite",!0):g.$setValidity("bmWebsite",!1),a});break;case"price":g.$parsers.push(function(a){var b=/^[0-9]{1,3}(?:,?[0-9]{3})*\.[0-9]{2}$/gm;return b.test(a)?g.$setValidity("price",!0):g.$setValidity("price",!1),a})}})}}}]);