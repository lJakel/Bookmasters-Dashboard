function BasicInfo(a){var b=this;b.Model={ProductGroupId:a.ProductGroupId||null,Title:a.Title||"",Subtitle:a.Subtitle||"",Publisher:a.Publisher||"",Imprint:a.Imprint||"",ContentLanguage:a.ContentLanguage||"",Series:a.Series||"",NumberinSeries:a.NumberinSeries||"",MainDescription:a.MainDescription||"",ShortDescription:a.ShortDescription||""}}function Covers(a,b){var c=this;c.Model={Covers:[]},c.log="",c.files={},c.upload=function(a,d){if(a){var e=d;c.files[e]={},c.files[e].status=null,b.Upload.upload({url:"//api.bookmasters.com/Files/Cover",data:{username:"poop",isbn13:d,CoverFile:a}}).then(function(a){c.files[e].name=a.config.data.CoverFile.name,c.files[e].type=a.config.data.CoverFile.type,c.files[e].size=a.config.data.CoverFile.size,c.files[e].status=!0,c.files[d].progress={percentage:"100%",width:100,color:"progress-bar-success"}},function(a){c.files[e].status=!1,c.files[d].progress={percentage:"Error",width:100,color:"progress-bar-danger"}},function(a){var b=parseInt(100*a.loaded/a.total);c.files[d].progress={percentage:b+"%",width:b,color:"progress-bar-info"}})}},c.formatBytes=function(a,b){if(0==a)return"0 Byte";var c=1e3,d=b+1||3,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return(a/Math.pow(c,f)).toPrecision(d)+" "+e[f]}}var Modals={ContributorBSModal:function(a,b){function c(){e.AdditionalTitles.push(new Components.AdditionalTitle(""))}function d(a){e.AdditionalTitles.splice(a,1)}var e=this;e.entryData=void 0,e.Method="",b.$timeout(function(){b.$scope.$watch(b.$scope.NTFNGForm.ContributorsModalForm.AdditionalTitleForm,function(a,b){console.log(a,b)})}),e.FirstName="",e.MiddleName="",e.LastName="",e.Prefix="",e.Suffix="",e.Hometown="",e.Role="",e.Biography="",e.FixedAuthorRoles=[],e.IsRolePrimary=!1,e.IsTitlePrimary=!1,e.AdditionalTitles=[],e.addAdditionalTitle=c,e.removeAdditionalTitle=d},FormatBSModal:function(a,b){function c(){$.each(l.FixedIsoCodes,function(a,b){b.checked=!1})}function d(){$.each(l.FixedIsoCodes,function(a,b){b.checked=!0})}function e(){if("undefined"!=typeof l.ProductType||""==l.ProductType||null==l.ProductType){var a=l.ProductType,b=l.FixedProductForms;l.DynamicProductForms=[],l.DynamicProductFormDetails=[],l.DynamicProductFormDetailSpecifics=[],l.ProductForm="",l.ProductDetail="",l.ProductBinding="",l.DynamicProductForms=b.filter(function(b){return b.MediaTypeId==a.Id})}}function f(){if("undefined"!=typeof l.ProductForm||""==l.ProductForm||null==l.ProductForm){var a=l.ProductForm,b=l.FixedProductFormDetails;l.DynamicProductFormDetails=[],l.DynamicProductFormDetailSpecifics=[],l.ProductDetail="",l.ProductBinding="",l.DynamicProductFormDetails=b.filter(function(b){return b.FormId==a.Id})}}function g(){if("undefined"!=typeof l.ProductDetail||""==l.ProductDetail||null==l.ProductDetail){var a=l.ProductDetail,b=l.FixedProductFormDetailSpecifics;l.DynamicProductFormDetailSpecifics=[],l.ProductBinding="",l.DynamicProductFormDetailSpecifics=b.filter(function(b){return b.FormDetailId==a.Id})}}function h(){l.Illustrations.push(new Components.Illustration(""))}function i(a){l.Illustrations.splice(a,1)}function j(){l.ComparableTitles.push(new Components.ComparableTitle(""))}function k(a){l.ComparableTitles.splice(a,1)}var l=this;l.entryData=void 0,l.Method="",l.ProductType=a.ProductType||"",l.ProductForm=a.ProductForm||"",l.ProductDetail=a.ProductDetail||"",l.ProductBinding=a.ProductBinding||"",l.ISBN13=a.ISBN13||"",l.Width=a.Width||"",l.Height=a.Height||"",l.Spine=a.Spine||"",l.Weight=a.Weight||"",l.PublicationDate=a.PublicationDate||"",l.Copyright=a.Copyright||"",l.StockDueDate=a.StockDueDate||"",l.TradeSales=a.TradeSales||"",l.Pages=a.Pages||"",l.CartonQuantity=a.CartonQuantity||"",l.USPrice=a.USPrice||"",l.DiscountCode=a.DiscountCode||"",l.CustomsValue=a.CustomsValue||"",l.Edition=a.Edition||"",l.EditionNumber=a.EditionNumber||"",l.EditionType=a.EditionType||"",l.CountryofOrigin=a.CountryofOrigin||"",l.PublicationLocation=a.PublicationLocation||"",l.TerritoryRights=a.TerritoryRights||"world",l.ComparableTitles=a.ComparableTitles||[],l.Illustrations=a.Illustrations||[],l.FixedProductTypes=[],l.FixedProductForms=[],l.FixedProductFormDetails=[],l.FixedProductFormDetailSpecifics=[],l.FixedIsoCodes=[],l.FixedIsoCodesPoop=[],l.FixedDiscountCodes=[],l.FixedEditionTypes=[],l.DynamicProductTypes=[],l.DynamicProductForms=[],l.DynamicProductFormDetails=[],l.DynamicProductFormDetailSpecifics=[],l.GetDynamicProductForms=e,l.GetDynamicProductDetails=f,l.GetDynamicProductFormDetailSpecifics=g,l.addIllustration=h,l.removeIllustration=i,l.addComparableTitle=j,l.removeComparableTitle=k,l.uncheckAllSalesRights=c,l.checkAllSalesRights=d,l.openCalendar=function(a){a.preventDefault(),a.stopPropagation(),l.CalendarIsOpen=!0},l.CalendarIsOpen=!1},ReviewModal:function(){var a=this;a.entryData=void 0,a.Method="",a.Method="",a.Name="",a.Publication="",a.Text=""},EndorsementModal:function(){var a=this;a.entryData=void 0,a.Method="",a.Name="",a.Affiliation="",a.Text=""},AppearanceAndEventModal:function(){var a=this;a.entryData=void 0,a.Method="",a.Name="",a.Date="",a.Location="",a.Text=""}},Contributors=function(a,b){function c(a,b){g.ContributorModal.Method=b||"edit",g.ContributorModal.entryData=a,$.each(a,function(b,c){g.ContributorModal[b]=a[b]||null}),g.showDialog=!0}function d(){$.each(g.ContributorModal.entryData,function(a,b){g.ContributorModal.entryData[a]=g.ContributorModal[a]}),"add"===g.ContributorModal.Method&&g.Model.Contributors.push(g.ContributorModal.entryData),g.showDialog=!1}function e(){g.showContributorModal(new Components.Contributor(""),"add")}function f(a){g.Model.Contributors.splice(a,1)}var g=this;g.Model={Contributors:a||[]},g.ContributorModal=new Modals.ContributorBSModal("",b),g.showDialog=!1,g.showContributorModal=c,g.onContributorModalAction=d,g.addContributor=e,g.removeContributor=f},Demographics=function(a,b){var c=this;c.Model={Audience:a.Audience||"",Bisacs:a.Bisacs||[],AgeRange:a.AgeFrom||""},c.FixedBisacListContainer=[],c.AgeRangeRequired=!1,c.AgeRangeDisabled=!0,c.AudienceRequired=!1,c.AudienceDisabled=!1,c.FixedList=[],c.FixedAudienceTypes=[],c.FixedIsoCodesPoop=[],b.$scope.$watchCollection(function(){return c.Model.Audience},function(a,b){"Children/juvenile"==a.Name?(c.AgeRangeRequired=!0,c.AgeRangeDisabled=!1):(c.AgeRangeRequired=!1,c.AgeRangeDisabled=!0)}),b.$scope.$watchCollection(function(){return c.Model.Bisacs},function(a,d){0==c.Model.Bisacs.length&&c.CheckJuv(),$.each(c.Model.Bisacs,function(a,d){b.$scope.$watchCollection(function(){return d},function(a,b){c.CheckJuv()})})}),c.UpdateBisacCodes=function(a){b.$timeout(function(){b.FixedReferences.lookupBisac(c.Model.Bisacs[a].BisacGroup.Id,function(b){c.FixedBisacListContainer[a]=b.data},function(a){alert()})})},$.each(c.Model.Bisacs,function(a,b){c.UpdateBisacCodes(a)}),c.addBisac=function(){c.Model.Bisacs.push(new Components.Bisac(c.FixedList||""))},c.removeBisac=function(a){c.Model.Bisacs.splice(a,1)},c.CheckJuv=function(){var a=!1;$.each(c.Model.Bisacs,function(b,c){("JUV"==c.BisacGroup.Prefix||"JNF"==c.BisacGroup.Prefix)&&(a=!0)}),a?($.each(c.FixedAudienceTypes,function(a,b){"Children/juvenile"==b.Name&&(c.Model.Audience=b)}),c.AudienceDisabled=!0,c.AudienceRequired=!1,c.AgeRangeRequired=!0,c.AgeRangeDisabled=!1):(c.AudienceDisabled=!1,c.AudienceRequired=!0,c.AgeRangeRequired=!1,c.AgeRangeDisabled=!0)}},Drafts=function(a,b){console.log(a);var c=this;c.Drafts=[],c.EmptyCache=function(){b.NewTitleDraftsFactory.EmptyCache().then(function(a){c.Drafts=[],c.Drafts=a.Drafts})},c.LoadDraft=function(b){a.LoadDraft(b)},c.RemoveDraft=function(a){b.NewTitleDraftsFactory.RemoveDraft(a)},c.GetDrafts=function(){b.NewTitleDraftsFactory.GetDrafts().then(function(a){c.Drafts=[],c.Drafts=a.Drafts})},c.FormatDate=function(a,b){return moment(a,"X").format("dddd, MMMM Do YYYY, h:mm:ss a")},c.GetDrafts(),c.SaveDraft=function(){b.NewTitleDraftsFactory.SaveDraft(JSON.stringify({DraftId:a.Form.DraftId,ProductGroupId:a.Form.ProductGroupId,CreationDate:a.Form.CreationDate,Content:{BasicInfo:a.BasicInfo.Model,Contributors:a.Contributors.Model,Formats:a.Formats.Model,Demographics:a.Demographics.Model,Marketing:a.Marketing.Model}})).then(function(a){c.Drafts=a.Drafts})}};BMApp.register.factory("FixedReferences",["$http","$q","$state","$timeout","$localStorage","AuthFactory",function(a,b,c,d,e,f){function g(){var a=Math.floor(Date.now()/1e3),b=5,c=24*b*60*60;e.FixedReferencesFactory=e.FixedReferencesFactory||{},e.FixedReferencesFactory.Cache=e.FixedReferencesFactory.Cache||null,(null==e.FixedReferencesFactory.Cache||a-e.FixedReferencesFactory.Cache>=c)&&(e.FixedReferencesFactory={Cache:Math.floor(Date.now()/1e3),IsoCodes:null,References:null,DiscountCodes:null})}function h(a,b){o.factory[b]=a,e.FixedReferencesFactory[b]=a}function i(b){return a.post("API/ISOCodes/Get").then(function(a){return h(a.data.data,"IsoCodes"),1==b?o.factory.IsoCodes:void 0},function(){setIsoCodes(null,"IsoCodes"),c.go("error",{code:"500",message:"An error occured loading the Country ISO Codes."})})}function j(){return g(),null==e.FixedReferencesFactory.IsoCodes?i(!0):(o.factory.IsoCodes=e.FixedReferencesFactory.IsoCodes,b.when(o.factory.IsoCodes))}function k(){return g(),null==e.FixedReferencesFactory.References?l(!0):(o.factory.references=e.FixedReferencesFactory.References,b.when(o.factory.references))}function l(b){return a.post("API/FixedReferences/GetAllReferences",{withCredentials:!1}).then(function(a){return h({ContributorRoles:a.data.ContributorRoles,BisacGroups:a.data.BisacGroups,Editions:a.data.EditionTypes,PublicationStatuses:a.data.PublicationStatuses,FixedProductTypes:a.data.MediaTypes,FixedProductForms:a.data.ProductForms,FixedProductFormDetails:a.data.ProductFormDetails,FixedProductFormDetailSpecifics:a.data.ProductFormDetailSpecifics,AudienceTypes:a.data.AudienceTypes},"References"),1==b?o.factory.References:void 0},function(a){h(null,"References"),c.go("error",{code:"500",message:"An error occured loading the fixed references."})})}function m(b,d,e){a.post("API/BisacCodes/GetGroupCodes",{groupId:b}).then(function(a){d(a.data)},function(a){c.go("error",{code:"500",message:"An error occured looking up the bisac code."})})}function n(){return null==e.FixedReferencesFactory.DiscountCodes?f.getInfo().then(function(a){return h(a.clientinfo.DiscountCodes,"DiscountCodes"),b.when(o.factory.DiscountCodes)}):(o.factory.DiscountCodes=e.FixedReferencesFactory.DiscountCodes,b.when(o.factory.DiscountCodes))}var o=this;return o.factory={getReferences:k,getIsoCodes:j,getDiscountCodes:n,lookupBisac:m,References:void 0,IsoCodes:void 0,DiscountCodes:void 0},o.factory}]),BMApp.register.factory("NewTitleDraftsFactory",["$q","$state","$localStorage","AuthFactory","GuidCreator","$timeout","toasty",function(a,b,c,d,e,f,g){function h(a){var b=this;b.UserId=a.UserId||n.UserId,b.Drafts=a.Drafts||[]}function i(a){var b=this;b.DraftId=a.DraftId||"",b.ProductGroupId=a.ProductGroupId||"",b.Title=a.Content.BasicInfo.Title||"",b.CreationDate=a.CreationDate||moment().format("X"),b.LastUpdated=a.LastUpdated||moment().format("X"),b.Content=JSON.stringify(a.Content)||""}function j(){return a(function(a,e){return n.Init?void a():void f(function(){d.getInfo().then(function(a){n.UserId=a.credentials.userid})}).then(function(){c.NewTitleDraftsFactory=c.NewTitleDraftsFactory||{},c.NewTitleDraftsFactory.Users=c.NewTitleDraftsFactory.Users||[];var d=c.NewTitleDraftsFactory.Users.filter(function(a){return a.UserId==n.UserId});d.length?n.factory.User=d[0]:n.factory.User=c.NewTitleDraftsFactory.Users[c.NewTitleDraftsFactory.Users.push(new h(""))-1],null!=n.UserId?(n.Init=!0,a()):e(b.go("error",{code:"500",message:"An unknown error occured in NewTitleDraftsFactory. (Reject cacheInit() UserID was not returned)"}))})})}function k(){return n.Init=!1,n.factory.User={},c.NewTitleDraftsFactory={},a.when(n.factory.User)}function l(){return j().then(function(){return a.when(n.factory.User)})}function m(a){return j().then(function(){var b=new i(JSON.parse(a)),c=n.factory.User.Drafts.map(function(a){return a.DraftId}).indexOf(b.DraftId);return 0>c?(n.factory.User.Drafts.unshift(b),g.success({title:"Saved Draft!",msg:"Your draft has been saved to your computer.",theme:"bootstrap",timeout:5e3})):(b.LastUpdated=moment().format("X"),n.factory.User.Drafts[c]=b,g.info({title:"Saved Draft!",msg:"Your draft has been updated.",theme:"bootstrap",timeout:5e3})),n.factory.User.Drafts.length>=4&&(n.factory.User.Drafts.length=4),l()})}var n=this;return n.UserId=null,n.Drafts=[],n.Init=!1,n.DraftLocation="",n.factory={User:{},Cache:{},EmptyCache:k,SaveDraft:m,GetDrafts:l},n.factory}]),BMApp.register.controller("NewTitleForm",["scriptLoader","$scope","$rootScope","$timeout","FixedReferences","$stateParams","GuidCreator","Upload","NewTitleDraftsFactory","toasty",function(a,b,c,d,e,f,g,h,i,j){function k(){l.BasicInfo=new BasicInfo(l.data.BasicInfo||"",l.Dependencies),l.Contributors=new Contributors(l.data.Contributors.Contributors||"",l.Dependencies),l.Formats=new Formats(l.data.Formats.Formats||"",l.Dependencies),l.Demographics=new Demographics(l.data.Demographics||"",l.Dependencies),l.Marketing=new Marketing(l.data.Marketing||"",l.Dependencies),l.Covers=new Covers(l.data.Covers||"",l.Dependencies),l.Drafts=new Drafts(l,l.Dependencies),l.LoadDraft=function(a){l.Form.DraftId=a.DraftId,l.Form.ProductGroupId=a.ProductGroupId,l.Form.CreationDate=a.CreationDate,l.data=JSON.parse(a.Content),k()},l.RefreshJson=function(){$("#jsonPre").text(JSON.stringify({Form:l.Form,BasicInfo:l.BasicInfo.Model,Contributors:l.Contributors.Model,Formats:l.Formats.Model,Demographics:l.Demographics.Model,Marketing:l.Marketing.Model,Covers:l.Covers.Model}))},e.getReferences().then(function(a){l.Contributors.ContributorModal.FixedAuthorRoles=a.ContributorRoles,l.Formats.FormatModal.FixedProductTypes=a.FixedProductTypes,l.Formats.FormatModal.FixedProductForms=a.FixedProductForms,l.Formats.FormatModal.FixedProductFormDetails=a.FixedProductFormDetails,l.Formats.FormatModal.FixedProductFormDetailSpecifics=a.FixedProductFormDetailSpecifics,l.Formats.FormatModal.FixedEditionTypes=a.Editions,l.Demographics.FixedAudienceTypes=a.AudienceTypes,l.Demographics.FixedList=a.BisacGroups}),e.getIsoCodes().then(function(a){l.Formats.FormatModal.FixedIsoCodes=a.codes}),e.getDiscountCodes().then(function(a){l.Formats.FormatModal.FixedDiscountCodes=a}),d(function(){$('[data-toggle="popover"]').popover()})}var l=this;l.Dependencies={scriptLoader:a,$scope:b,$rootScope:c,$timeout:d,FixedReferences:e,$stateParams:f,toasty:j,NewTitleDraftsFactory:i,Upload:h},l.data={BasicInfo:{},Contributors:{},Demographics:{},Formats:{},Marketing:{}},l.Form={DraftId:g.CreateGuid(),ProductGroupId:null,CreationDate:moment().format("X")},d(function(){}).then(k)}]);var Formats=function(a,b){var c=this;c.Model={Formats:a||[]},c.FormatModal=new Modals.FormatBSModal("",b.$scope),c.showDialog=!1,c.showFormatModal=function(a,d){b.$scope.$broadcast("show-errors-reset"),c.FormatModal.Method=d||"edit",c.FormatModal.entryData=a,$.each(a,function(b,d){c.FormatModal[b]=a[b]||null}),b.$timeout(function(){c.FormatModal.GetDynamicProductForms()}).then(function(){c.FormatModal.ProductForm=a.ProductForm}),b.$timeout(function(){c.FormatModal.GetDynamicProductDetails()}).then(function(){c.FormatModal.ProductDetail=a.ProductDetail}),b.$timeout(function(){c.FormatModal.GetDynamicProductFormDetailSpecifics()}).then(function(){c.FormatModal.ProductBinding=a.ProductBinding}),c.showDialog=!0},c.onFormatModalAction=function(){$.each(c.FormatModal.entryData,function(a,b){c.FormatModal.entryData[a]=c.FormatModal[a]}),"add"===c.FormatModal.Method&&c.Model.Formats.push(c.FormatModal.entryData),c.showDialog=!1},c.addFormat=function(){c.showFormatModal(new Components.Format(""),"add")},c.removeFormat=function(a){c.Model.Formats.splice(a,1)}},Marketing=function(a){function b(a){g.Model[a+"s"].push(new Components[a])}function c(a){g.showMarketingItemModal(new Components[a],a,"add")}function d(a,b,c){g[b+"Modal"].Method=c||"edit",g[b+"Modal"].entryData=a,$.each(a,function(c,d){g[b+"Modal"][c]=a[c]||null}),g["show"+b+"Dialog"]=!0}function e(a){$.each(g[a+"Modal"].entryData,function(b,c){g[a+"Modal"].entryData[b]=g[a+"Modal"][b]}),"add"===g[a+"Modal"].Method&&g.Model[a+"s"].push(g[a+"Modal"].entryData),g["show"+a+"Dialog"]=!1}function f(a,b){g.Model[a+"s"].splice(b,1)}var g=this;g.Model={Websites:a.Websites||[],MarketingAndPublicitys:a.MarketingAndPublicitys||[],Reviews:a.Reviews||[],Endorsements:a.Endorsements||[],AppearanceAndEvents:a.AppearanceAndEvents||[]},g.addSingleMarketingItem=b,g.addMarketingItem=c,g.showMarketingItemModal=d,g.onMarketingItemModalAction=e,g.removeMarketingItem=f,g.ReviewModal=new Modals.ReviewModal(""),g.showReviewDialog=!1,g.EndorsementModal=new Modals.EndorsementModal(""),g.showEndorsementDialog=!1,g.AppearanceAndEventModal=new Modals.AppearanceAndEventModal(""),g.showAppearanceAndEventDialog=!1},Components={AdditionalTitle:function(a){var b=this;b.ISBN=a.ISBN||"",b.Title=a.Title||""},Contributor:function(a){var b=this;b.FirstName=a.FirstName||"",b.MiddleName=a.MiddleName||"",b.LastName=a.LastName||"",b.Prefix=a.Prefix||"",b.Suffix=a.Suffix||"",b.Hometown=a.Hometown||"",b.Role=a.Role||"",b.Biography=a.Biography||"",b.IsRolePrimary=a.IsRolePrimary||!1,b.IsTitlePrimary=a.IsTitlePrimary||!1,b.AdditionalTitles=a.AdditionalTitles||[]},Bisac:function(a){var b=this;b.FixedList=[],b.FixedList2=[],b.BisacGroup="",b.Code="",b.Text="",b.Group="",b.LongName="",b.BisacID=""},Review:function(){var a=this;a.Name="",a.Publication="",a.Text=""},MarketingAndPublicity:function(){var a=this;a.Type="",a.Description=""},AppearanceAndEvent:function(){var a=this;a.EventName="",a.Date="",a.Location="",a.Description=""},Website:function(){var a=this;a.URL="",a.Type=""},Endorsement:function(){var a=this;a.Name="",a.Affiliation="",a.Text=""},Format:function(a){var b=this;b.ProductType=a.ProductType||"",b.ProductForm=a.ProductForm||"",b.ProductDetail=a.ProductDetail||"",b.ProductBinding=a.ProductBinding||"",b.ISBN13=a.ISBN13||"",b.Width=a.Width||"",b.Height=a.Height||"",b.Spine=a.Spine||"",b.Weight=a.Weight||"",b.PublicationDate=a.PublicationDate||"",b.Copyright=a.Copyright||"",b.StockDueDate=a.StockDueDate||"",b.TradeSales=a.TradeSales||"",b.Pages=a.Pages||"",b.CartonQuantity=a.CartonQuantity||"",b.USPrice=a.USPrice||"",b.DiscountCode=a.DiscountCode||"",b.CustomsValue=a.CustomsValue||"",b.Edition=a.Edition||"",b.EditionNumber=a.EditionNumber||"",b.EditionType=a.EditionType||"",b.CountryofOrigin=a.CountryofOrigin||"",b.PublicationLocation=a.PublicationLocation||"",b.ComparableTitles=a.ComparableTitles||[]},ComparableTitle:function(a){var b=this;b.ISBN=a.ISBN||"",b.Title=a.Title||""},Illustration:function(a){var b=this;b.Type=a.Type||"",b.Description=a.Description||"",b.Number=a.Number||""}};